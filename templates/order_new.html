{% extends "base.html" %}
{% block title %}New Order for Table {{ table.table_number }}{% endblock %}

{% block content %}
    <h2>Start New Order - Table {{ table.table_number }}</h2>
    <p class="text-muted">Capacity: {{ table.capacity }} | Current Status: {{ table.status|capitalize }}</p>
    <hr>

    {% if table.status == 'available' %}
    <form action="{{ url_for('order_new', table_id=table._id) }}" method="POST">
        <div class="card mb-4">
            <div class="card-header">
                Select Initial Items (Optional)
            </div>
            <div class="card-body">
                {% if menu_items %}
                    {% for item in menu_items %}
                        <div class="row mb-2 align-items-center">
                            <div class="col-md-8">
                                {# --- FIX APPLIED HERE --- #}
                                <label for="item_{{ item._id }}" class="form-label">{{ item.name }} (â‚¹{{ "%.2f"|format(item.price) }})</label>
                            </div>
                            <div class="col-md-4">
                                {# Use item._id in the name attribute to easily identify quantities in the POST request #}
                                <input type="number" class="form-control form-control-sm" id="item_{{ item._id }}" name="quantity_{{ item._id }}" value="0" min="0">
                            </div>
                        </div>
                    {% endfor %}
                     <p class="form-text mt-3">Enter quantity for items to add initially. Leave as 0 to skip.</p>
                {% else %}
                    <p class="text-muted">No menu items available to add.</p>
                {% endif %}
            </div>
        </div>

        <div class="mt-3">
            <button type="submit" class="btn btn-success">Start Order</button>
            <a href="{{ url_for('tables_manage') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
    {% else %}
        <div class="alert alert-warning">
            Cannot start a new order. Table {{ table.table_number }} is currently {{ table.status }}.
             {% if table.status == 'occupied' and table.current_order_id %}
                 <a href="{{ url_for('order_view', order_id=table.current_order_id) }}">View existing order?</a>
             {% endif %}
        </div>
         <a href="{{ url_for('tables_manage') }}" class="btn btn-secondary">Back to Tables</a>
    {% endif %}

{% endblock %}