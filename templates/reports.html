{% extends "base.html" %}
{% block title %}Reports & Analytics{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-4">
         <h2><i class="fas fa-chart-line me-2"></i>Reports & Analytics</h2>
         {# Optional: Add a download button later #}
    </div>

    {# Period Selection Controls #}
    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-filter me-1"></i> Select Report Period
        </div>
        <div class="card-body">
            <div class="btn-group flex-wrap" role="group" aria-label="Report Period Selection"> {# Use flex-wrap for responsiveness #}
                <a href="{{ url_for('reports', period='today') }}" class="btn btn-sm {% if selected_period == 'today' %}btn-primary{% else %}btn-outline-secondary{% endif %} mb-1 me-1">Today</a>
                <a href="{{ url_for('reports', period='yesterday') }}" class="btn btn-sm {% if selected_period == 'yesterday' %}btn-primary{% else %}btn-outline-secondary{% endif %} mb-1 me-1">Yesterday</a>
                <a href="{{ url_for('reports', period='month') }}" class="btn btn-sm {% if selected_period == 'month' %}btn-primary{% else %}btn-outline-secondary{% endif %} mb-1 me-1">This Month</a>
                <a href="{{ url_for('reports', period='prev_month') }}" class="btn btn-sm {% if selected_period == 'prev_month' %}btn-primary{% else %}btn-outline-secondary{% endif %} mb-1 me-1">Last Month</a>
                <a href="{{ url_for('reports', period='year') }}" class="btn btn-sm {% if selected_period == 'year' %}btn-primary{% else %}btn-outline-secondary{% endif %} mb-1 me-1">This Year</a>
                {# Placeholder for custom date range selection if needed later
                <button type="button" class="btn btn-sm btn-outline-secondary mb-1 me-1" data-bs-toggle="modal" data-bs-target="#customDateModal">Custom Range</button>
                 #}
            </div>
        </div>
    </div>


    <p class="text-muted mb-4">
        Showing report for: <strong>{{ selected_period_display }}</strong>
        {# Display date range (adjust end date for display: $lt means up to, but not including) #}
        {% if start_date and end_date %}
            <span class="ms-2">(<i class="fas fa-calendar-alt me-1"></i>{{ start_date.strftime('%b %d, %Y') }} - {{ (end_date - timedelta(seconds=1)).strftime('%b %d, %Y') }})</span>
        {% endif %}
    </p>
    <hr>

     {% if db_error %}
        <div class="alert alert-danger"><i class="fas fa-database me-2"></i>Database connection error prevented report generation.</div>
     {% else %}
        <div class="row g-4">
            <!-- Sales Summary Card -->
            <div class="col-lg-6 mb-4">
                <div class="card h-100">
                     {# Updated Card Header #}
                    <div class="card-header"><i class="fas fa-dollar-sign me-2"></i>Sales Summary ({{ selected_period_display }})</div>
                    <div class="card-body d-flex flex-column"> {# Use flex column #}
                        <div class="row text-center">
                            <div class="col-6 border-end"> {# Add border #}
                                <p class="text-muted mb-1 small text-uppercase">Total Sales</p>
                                <h4 class="mb-0 price-text"><span class="currency-symbol">₹</span>{{ "%.2f"|format(report_data.total_sales) }}</h4>
                            </div>
                            <div class="col-6">
                                <p class="text-muted mb-1 small text-uppercase">Transactions</p>
                                <h4 class="mb-0">{{ report_data.bill_count }}</h4>
                            </div>
                        </div>
                         {# Optional: Average Bill - push to bottom #}
                         <div class="mt-auto pt-3 text-center border-top"> {# mt-auto pushes down #}
                            <p class="text-muted mb-1 small text-uppercase">Average Bill Value</p>
                            <h5 class="mb-0 price-text">
                                <span class="currency-symbol">₹</span>{{ "%.2f"|format(report_data.total_sales / report_data.bill_count) if report_data.bill_count > 0 else "0.00" }}
                            </h5>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Selling Items Card -->
            <div class="col-lg-6 mb-4">
                <div class="card h-100">
                     {# Updated Card Header #}
                    <div class="card-header"><i class="fas fa-star me-2"></i>Top Selling Items ({{ selected_period_display }})</div>
                    <div class="card-body p-0"> {# Remove padding for list #}
                        {% if report_data.top_selling_items %}
                        <div class="table-responsive"> {# Wrap list in table-responsive for consistency #}
                            <ul class="list-group list-group-flush">
                                {% for item in report_data.top_selling_items %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-utensil-spoon me-2 text-muted"></i>{{ item._id }}</span>
                                    <span class="badge bg-primary rounded-pill">{{ item.total_quantity }} sold</span>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% else %}
                        <p class="text-muted p-3 text-center mb-0">No sales data available for this period.</p>
                        {% endif %}
                    </div>
                     <div class="card-footer text-muted small">
                         Top 5 items by quantity sold in the selected period.
                     </div>
                </div>
            </div>
        </div>

        {# Add space for more report types later #}
        {#
        <hr class="my-4">
        <p class="text-muted text-center"><i class="fas fa-chart-pie me-1"></i>More reports can be added (e.g., sales by category, time trends).</p>
        #}

     {% endif %} {# End if not db_error #}
{% endblock %}

{% block scripts_extra %}
    {# Add JavaScript for custom date range picker here if implemented later #}
{% endblock %}